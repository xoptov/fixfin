{% extends "AppBundle::layout.html.twig" %}

{% block content %}
    {% if rates is not empty %}
    <ul class="nav nav-tabs">
    {% for rate in rates %}
        <li class="{% if loop.first %}active{% endif %}">
            <a href="#table_{{ rate.id }}">{{ rate.name }}</a>
        </li>
    {% endfor %}
    </ul>
    <div class="tab-content">
    {% for rate in rates %}
        {% set active_ticket = false %}
        <div class="tab-pane{% if loop.first %} active{% endif %} col-lg-12" id="table_{{ rate.id }}">
        {% for ticket in tickets %}
            {% if ticket.rate == rate %}
                {% set active_ticket = ticket %}
            {% endif %}
        {% endfor %}
        {% if active_ticket %}
            <div class="row">
                <div class="col-lg-10 table-activated">Стол активен до: {{ active_ticket.expired|date("d-m-Y H:i") }}</div>
                <div class="col-lg-2">
                    <a class="btn btn-primary" href="{{ path('app_dashboard_prolong', {'ticket': active_ticket.id}) }}">Продлить</a>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    {# todo необходимо таблицу рэндерить в отдельном контроллере #}
                    <table class="table">
                        <thead>
                        <tr>
                            <th>№</th>
                            <th>ID</th>
                            <th>Имя Фамилия</th>
                            <th>Почта</th>
                            <th>Телефон</th>
                            <th>Квалификация</th>
                            <th>Кол. реф.</th>
                            <th>Статус</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>{{ loop.index0 }}</td>
                            <td>585</td>
                            <td>Иванов И.</td>
                            <td>ivanov@mail.ru</td>
                            <td>+7 000 000 0000</td>
                            <td>выполнена</td>
                            <td>15</td>
                            <td>активен</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        {% else %}
            <div class="row">
                <div class="col-lg-9 col-md-8 col-sm-8 col-xs-8 table-activated">{{ rate.name }} неактивен!</div>
                <div class="col-lg-3 col-md-4 col-sm-4 col-xs-4 text-right">
                    <a class="btn btn-primary" href="{{ path('app_dashboard_open', {'rate': rate.id}) }}">Активировать</a>
                </div>
            </div>
        {% endif %}
        </div>
    {% endfor %}
    </div>
    {% else %}
    <div class="window">
        <div class="header">
            <h3>Работа со столами</h3>
        </div>
        <div class="content">
            Извените но на данный момент столы в системе не созданы!
        </div>
    </div>
    {% endif %}
{% endblock %}

{% if rates is not empty %}
    {% block javascripts %}
    <script>
        var dashboard = modulejs.require('dashboard');
        dashboard.start();
    </script>
    {% endblock %}
{% endif %}